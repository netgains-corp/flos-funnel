<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategiegespr√§ch Bewerbung</title>
    
    <!-- Calendly CSS -->
    <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
    
    <style>
        /* --- Styles basierend auf Florians CI (Dark Mode Edition) --- */
        :root {
            --color-dark: #10103D;   /* K√∂nigsblau (Hintergrund Seite) */
            --color-card-bg: #0b0b2e; /* Sehr dunkles Blau f√ºr die Karte */
            --color-primary: #00ACF0; /* Hellblau (Glow & Akzente) */
            --color-primary-glow: rgba(0, 172, 240, 0.6);
            --color-gold: #CBB26A;
            --color-text: #FFFFFF;
            --color-text-muted: #B0B0C0;
            --color-border: #2a2a5a;
            --font-family: 'Montserrat', sans-serif;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--color-dark);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: var(--color-text);
        }

        .funnel-container {
            background: var(--color-card-bg);
            width: 100%;
            max-width: 600px; /* Standard Breite f√ºr Fragen */
            border-radius: 16px;
            box-shadow: 0 0 80px 10px var(--color-primary-glow);
            border: 1px solid rgba(0, 172, 240, 0.3);
            overflow: hidden;
            position: relative;
            transition: max-width 0.5s ease; /* Animation bei Verbreiterung f√ºr Kalender */
        }

        /* Klasse f√ºr breitere Ansicht beim Kalender */
        .funnel-container.wide-mode {
            max-width: 1000px;
        }

        .header {
            background-color: rgba(255, 255, 255, 0.05);
            padding: 25px 20px 15px;
            text-align: center;
            border-bottom: 1px solid var(--color-border);
            position: relative; 
        }

        .header h2 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--color-text);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        /* Musik Toggle Button Style - Moderne Glas Optik */
        .music-toggle {
            position: fixed;
            bottom: 20px;
            left: 20px;
            
            /* Glassmorphism */
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            
            color: rgba(255, 255, 255, 0.7);
            
            border-radius: 50%;
            width: 45px;
            height: 45px;
            padding: 0;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
            z-index: 9999;
        }

        .music-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            transform: scale(1.05);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .music-toggle.playing {
            color: var(--color-primary);
            border-color: rgba(0, 172, 240, 0.5);
            background: rgba(0, 172, 240, 0.15);
            box-shadow: 0 0 15px rgba(0, 172, 240, 0.4);
            opacity: 1;
        }

        /* Anpassung f√ºr sehr kleine Screens */
        @media (max-width: 400px) {
            .music-toggle {
                bottom: 10px;
                left: 10px;
                width: 40px;
                height: 40px;
            }
        }

        .progress-bar {
            height: 4px;
            background-color: rgba(255, 255, 255, 0.1);
            width: 100%;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--color-primary);
            width: 0%;
            transition: width 0.4s ease;
            box-shadow: 0 0 10px var(--color-primary);
        }

        .step {
            display: none;
            padding: 40px 30px;
            animation: fadeIn 0.5s ease;
        }

        .step.active {
            display: block;
        }

        /* Spezielles Styling f√ºr den Kalender-Step */
        .step-calendar {
            padding: 0;
            background: white; /* Calendly braucht meist hellen Hintergrund oder Custom CSS */
            height: 650px;     /* Feste H√∂he f√ºr Calendly */
        }

        h3 {
            margin-top: 0;
            font-size: 1.4rem;
            margin-bottom: 30px;
            text-align: center;
            line-height: 1.4;
            color: var(--color-text);
            text-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        /* --- Auswahl-Karten (Radio & Checkbox) --- */
        .option-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-card {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            background-color: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .option-card:hover {
            border-color: var(--color-primary);
            background-color: rgba(0, 172, 240, 0.1);
            transform: translateX(5px);
        }

        .option-card.selected {
            border-color: var(--color-primary);
            background-color: rgba(0, 172, 240, 0.15);
            box-shadow: 0 0 15px rgba(0, 172, 240, 0.2) inset;
        }

        .option-input {
            margin-right: 15px;
            accent-color: var(--color-primary);
            transform: scale(1.3);
            cursor: pointer;
        }

        .option-label {
            font-weight: 500;
            width: 100%;
            pointer-events: none;
            font-size: 1.05rem;
            color: var(--color-text);
        }

        /* --- Text Inputs --- */
        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--color-text-muted);
            letter-spacing: 0.5px;
        }

        .text-input {
            width: 100%;
            padding: 14px 15px;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            font-size: 1rem;
            box-sizing: border-box;
            font-family: inherit;
            background-color: rgba(255, 255, 255, 0.05); 
            color: var(--color-text);
            transition: all 0.3s;
        }

        .text-input::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }

        .text-input:focus {
            border-color: var(--color-primary);
            background-color: rgba(0, 172, 240, 0.05);
            outline: none;
            box-shadow: 0 0 15px rgba(0, 172, 240, 0.2);
        }

        /* --- Buttons --- */
        .btn-container {
            margin-top: 35px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn {
            padding: 14px 30px;
            border-radius: 6px;
            font-weight: 700;
            cursor: pointer;
            border: none;
            font-size: 1rem;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-next {
            background-color: var(--color-primary);
            color: white;
            width: 100%;
            box-shadow: 0 0 20px rgba(0, 172, 240, 0.4);
            position: relative;
            overflow: hidden;
        }

        .btn-next:hover {
            background-color: #33bfff;
            box-shadow: 0 0 30px rgba(0, 172, 240, 0.6);
            transform: translateY(-2px);
        }

        .btn-back {
            background-color: transparent;
            color: var(--color-text-muted);
            padding-left: 0;
            text-transform: none;
            font-weight: 600;
        }

        .btn-back:hover {
            color: var(--color-text);
        }

        .hidden { display: none; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Loader */
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid var(--color-primary);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
    <!-- Calendly Script -->
    <script type="text/javascript" src="https://assets.calendly.com/assets/external/widget.js" async></script>
    <!-- Schriftart laden -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

<!-- Musik Toggle Button -->
<button class="music-toggle" id="musicBtn" onclick="toggleMusic()" title="Hintergrundmusik an/aus">
    <span>üéµ</span>
</button>

<div class="funnel-container" id="funnelContainer">
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>
    <div class="header" id="funnelHeader">
        <h2>Strategiegespr√§ch</h2>
    </div>

    <!-- Audio Element - Klassische Musik (Erik Satie - Gymnop√©die No. 1) -->
    <!-- 'autoplay' Attribut hinzugef√ºgt, 'preload' auf auto -->
    <audio id="bgMusic" loop preload="auto" autoplay>
        <source src="https://cdn.pixabay.com/audio/2022/03/10/audio_4a11a72764.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <form id="applicationForm">
        
        <!-- SCHRITT 1: ERFAHRUNG -->
        <div class="step active" data-step="1">
            <h3>In welchen Bereichen hast du<br>bereits Erfahrung?</h3>
            <p style="text-align: center; color: var(--color-text-muted); font-size: 0.9rem; margin-top: -20px; margin-bottom: 25px;">(Mehrfachauswahl m√∂glich)</p>
            
            <div class="option-group">
                <div class="option-card" onclick="toggleCheckbox(this)">
                    <input type="checkbox" name="erfahrung" value="Keine" class="option-input" onchange="handleNoneOption(this)">
                    <span class="option-label">Keine / Einsteiger</span>
                </div>
                <div class="option-card" onclick="toggleCheckbox(this)">
                    <input type="checkbox" name="erfahrung" value="Aktien_ETFs" class="option-input">
                    <span class="option-label">Aktien / ETFs</span>
                </div>
                <div class="option-card" onclick="toggleCheckbox(this)">
                    <input type="checkbox" name="erfahrung" value="Gold_Edelmetalle" class="option-input">
                    <span class="option-label">Gold / Edelmetalle</span>
                </div>
                <div class="option-card" onclick="toggleCheckbox(this)">
                    <input type="checkbox" name="erfahrung" value="Crypto" class="option-input">
                    <span class="option-label">Krypto</span>
                </div>
            </div>
            <div class="btn-container">
                <div style="width: 10px;"></div>
                <button type="button" class="btn btn-next" onclick="nextStep(2)">Weiter</button>
            </div>
        </div>

        <!-- SCHRITT 2: EINKOMMEN -->
        <div class="step" data-step="2">
            <h3>Wie hoch ist dein aktuelles<br>Jahresbruttoeinkommen?</h3>
            <div class="option-group">
                <div class="option-card" onclick="selectRadio(this, 'gehalt')">
                    <input type="radio" name="gehalt" value="unter_50k" class="option-input">
                    <span class="option-label">Unter 50.000 ‚Ç¨</span>
                </div>
                <div class="option-card" onclick="selectRadio(this, 'gehalt')">
                    <input type="radio" name="gehalt" value="50k_100k" class="option-input">
                    <span class="option-label">50.000 ‚Ç¨ ‚Äì 100.000 ‚Ç¨</span>
                </div>
                <div class="option-card" onclick="selectRadio(this, 'gehalt')">
                    <input type="radio" name="gehalt" value="100k_250k" class="option-input">
                    <span class="option-label">100.000 ‚Ç¨ ‚Äì 250.000 ‚Ç¨</span>
                </div>
                <div class="option-card" onclick="selectRadio(this, 'gehalt')">
                    <input type="radio" name="gehalt" value="ueber_250k" class="option-input">
                    <span class="option-label">√úber 250.000 ‚Ç¨</span>
                </div>
            </div>
            <div class="btn-container">
                <button type="button" class="btn btn-back" onclick="prevStep(1)">Zur√ºck</button>
                <button type="button" class="btn btn-next" style="width: auto; min-width: 120px;" onclick="nextStep(3)">Weiter</button>
            </div>
        </div>

        <!-- SCHRITT 3: INVESTITIONSKAPITAL -->
        <div class="step" data-step="3">
            <h3>Wie viel Kapital willst du<br>investieren?</h3>
            <div class="option-group">
                <div class="option-card" onclick="selectRadio(this, 'kapital')">
                    <input type="radio" name="kapital" value="unter_10k" class="option-input">
                    <span class="option-label">Unter 10.000 ‚Ç¨</span>
                </div>
                <div class="option-card" onclick="selectRadio(this, 'kapital')">
                    <input type="radio" name="kapital" value="10k_50k" class="option-input">
                    <span class="option-label">10.000 ‚Ç¨ ‚Äì 50.000 ‚Ç¨</span>
                </div>
                <div class="option-card" onclick="selectRadio(this, 'kapital')">
                    <input type="radio" name="kapital" value="50k_200k" class="option-input">
                    <span class="option-label">50.000 ‚Ç¨ ‚Äì 200.000 ‚Ç¨</span>
                </div>
                <div class="option-card" onclick="selectRadio(this, 'kapital')">
                    <input type="radio" name="kapital" value="ueber_200k" class="option-input">
                    <span class="option-label">√úber 200.000 ‚Ç¨</span>
                </div>
            </div>
            <div class="btn-container">
                <button type="button" class="btn btn-back" onclick="prevStep(2)">Zur√ºck</button>
                <button type="button" class="btn btn-next" style="width: auto; min-width: 120px;" onclick="nextStep(4)">Weiter</button>
            </div>
        </div>

        <!-- SCHRITT 4: KONTAKTDATEN -->
        <div class="step" data-step="4">
            <h3>Fast geschafft!<br>Wie k√∂nnen wir dich erreichen?</h3>
            
            <div class="input-group">
                <label for="name">Vor- und Nachname</label>
                <input type="text" id="name" name="name" class="text-input" placeholder="Max Mustermann" required>
            </div>

            <div class="input-group">
                <label for="email">E-Mail Adresse</label>
                <input type="email" id="email" name="email" class="text-input" placeholder="max@beispiel.de" required>
            </div>

            <div class="input-group">
                <label for="phone">Telefonnummer (f√ºr R√ºckfragen)</label>
                <input type="tel" id="phone" name="phone" class="text-input" placeholder="+49 170 1234567" required>
            </div>

            <div class="btn-container">
                <button type="button" class="btn btn-back" onclick="prevStep(3)">Zur√ºck</button>
                <button type="button" class="btn btn-next" id="submitBtn" style="width: auto;" onclick="submitForm()">
                    Jetzt Termin ausw√§hlen
                </button>
            </div>
            <!-- Lade-Status -->
            <div id="loadingIndicator" class="hidden" style="text-align: center; margin-top: 20px;">
                <div class="loader"></div>
                <p style="font-size: 0.9rem; color: var(--color-text-muted); margin-top: 10px;">Daten werden verarbeitet...</p>
            </div>
        </div>

        <!-- SCHRITT 5: CALENDLY WIDGET (Container) -->
        <div class="step step-calendar" data-step="5">
            <!-- Hier wird Calendly reingeladen -->
            <div id="calendly-embed" style="min-width:320px;height:650px;"></div>
        </div>

    </form>
</div>

<script>
    // --- KONFIGURATION ---
    const N8N_WEBHOOK_URL = 'https://n8n.srv1164949.hstgr.cloud/webhook/c775ebbb-3997-4d31-8d2c-f7a74bf9bf04'; 
    const CALENDLY_LINK = 'https://calendly.com/f-merzenich/60min';

    let currentStep = 1;
    const totalSteps = 5; 
    let isMusicPlaying = false;
    const bgMusic = document.getElementById("bgMusic");
    // Lautst√§rke etwas senken f√ºr Hintergrundmusik
    bgMusic.volume = 0.3;

    // Versuche Autoplay beim Laden
    document.addEventListener('DOMContentLoaded', function() {
        const btn = document.getElementById("musicBtn");
        
        // Promise-Handling f√ºr Autoplay
        const playPromise = bgMusic.play();
        
        if (playPromise !== undefined) {
            playPromise.then(_ => {
                // Autoplay hat funktioniert
                isMusicPlaying = true;
                btn.classList.add("playing");
            })
            .catch(error => {
                // Autoplay wurde blockiert (Browser Policy)
                console.log("Autoplay prevented by browser policy.");
                isMusicPlaying = false;
                btn.classList.remove("playing");
            });
        }
    });

    function toggleMusic() {
        const btn = document.getElementById("musicBtn");
        
        if (isMusicPlaying) {
            bgMusic.pause();
            isMusicPlaying = false;
            btn.classList.remove("playing");
            btn.style.opacity = "0.5"; // Visuelles Feedback f√ºr "Aus"
        } else {
            bgMusic.play().then(() => {
                isMusicPlaying = true;
                btn.classList.add("playing");
                btn.style.opacity = "1"; // Visuelles Feedback f√ºr "An"
            }).catch(e => {
                console.log("Error playing music:", e);
            });
        }
    }

    function updateProgress() {
        const displayPercentage = currentStep === totalSteps ? 100 : ((currentStep - 1) / (totalSteps - 1)) * 100;
        document.getElementById('progressFill').style.width = displayPercentage + '%';
        
        if(currentStep === totalSteps) {
            document.getElementById('funnelHeader').querySelector('h2').innerText = "Termin buchen";
        }
    }

    function selectRadio(cardElement, groupName) {
        const input = cardElement.querySelector('input');
        input.checked = true;

        const allCards = document.querySelectorAll(`input[name="${groupName}"]`);
        allCards.forEach(rb => {
            rb.closest('.option-card').classList.remove('selected');
        });
        cardElement.classList.add('selected');

        setTimeout(() => {
             const stepDiv = cardElement.closest('.step');
             const stepNum = parseInt(stepDiv.getAttribute('data-step'));
             if(stepNum < 4) nextStep(stepNum + 1); 
        }, 300);
    }

    function toggleCheckbox(cardElement) {
        const input = cardElement.querySelector('input');
        input.checked = !input.checked;
        
        if(input.checked) {
            cardElement.classList.add('selected');
            if (input.value === 'Keine') {
                const otherInputs = document.querySelectorAll('input[name="erfahrung"]:not([value="Keine"])');
                otherInputs.forEach(cb => {
                    cb.checked = false;
                    cb.closest('.option-card').classList.remove('selected');
                });
            } else {
                const noneInput = document.querySelector('input[name="erfahrung"][value="Keine"]');
                if (noneInput && noneInput.checked) {
                    noneInput.checked = false;
                    noneInput.closest('.option-card').classList.remove('selected');
                }
            }
        } else {
            cardElement.classList.remove('selected');
        }
    }

    document.querySelectorAll('.option-input').forEach(input => {
        input.addEventListener('click', (e) => e.stopPropagation());
        input.addEventListener('change', (e) => {
            const card = e.target.closest('.option-card');
            if(e.target.type === 'radio') {
                const group = e.target.name;
                document.querySelectorAll(`input[name="${group}"]`).forEach(rb => {
                    rb.closest('.option-card').classList.remove('selected');
                });
                card.classList.add('selected');
                setTimeout(() => {
                    const stepDiv = card.closest('.step');
                    const stepNum = parseInt(stepDiv.getAttribute('data-step'));
                    if(stepNum < 4) nextStep(stepNum + 1);
               }, 300);
            } else {
                if(e.target.checked) card.classList.add('selected');
                else card.classList.remove('selected');
                
                if (e.target.checked && e.target.value === 'Keine') {
                     document.querySelectorAll('input[name="erfahrung"]:not([value="Keine"])').forEach(cb => {
                        cb.checked = false;
                        cb.closest('.option-card').classList.remove('selected');
                    });
                } else if (e.target.checked && e.target.value !== 'Keine') {
                    const noneInput = document.querySelector('input[name="erfahrung"][value="Keine"]');
                    if (noneInput && noneInput.checked) {
                        noneInput.checked = false;
                        noneInput.closest('.option-card').classList.remove('selected');
                    }
                }
            }
        });
    });

    function nextStep(targetStep) {
        if(currentStep === 1) {
            const selected = document.querySelectorAll('input[name="erfahrung"]:checked');
            if(selected.length === 0) { alert("Bitte w√§hle mindestens eine Option aus."); return; }
        }
        if(currentStep === 2) {
            const salary = document.querySelector('input[name="gehalt"]:checked');
            if(!salary) { alert("Bitte w√§hle eine Einkommensstufe aus."); return; }
        }
        if(currentStep === 3) {
            const capital = document.querySelector('input[name="kapital"]:checked');
            if(!capital) { alert("Bitte w√§hle dein Kapital aus."); return; }
        }

        document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
        document.querySelector(`.step[data-step="${targetStep}"]`).classList.add('active');
        currentStep = targetStep;
        updateProgress();
    }

    function prevStep(targetStep) {
        document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
        document.querySelector(`.step[data-step="${targetStep}"]`).classList.add('active');
        currentStep = targetStep;
        updateProgress();
    }

    async function submitForm() {
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const phone = document.getElementById('phone').value;

        if(!name || !email || !phone) {
            alert("Bitte f√ºlle alle Kontaktfelder aus.");
            return;
        }

        const btn = document.getElementById('submitBtn');
        const loader = document.getElementById('loadingIndicator');
        btn.classList.add('hidden');
        loader.classList.remove('hidden');

        const erfahrungen = Array.from(document.querySelectorAll('input[name="erfahrung"]:checked'))
                                .map(cb => cb.value)
                                .join(', ');

        const formData = {
            erfahrung: erfahrungen,
            gehalt: document.querySelector('input[name="gehalt"]:checked')?.value,
            kapital: document.querySelector('input[name="kapital"]:checked')?.value,
            name: name,
            email: email,
            phone: phone,
            source: 'webseite_funnel_v2',
            date: new Date().toISOString()
        };

        try {
            // Sende an n8n (CORS muss auf dem Server erlaubt sein oder es gibt einen Fehler im Browser, 
            // wobei der Request oft trotzdem durchgeht bei 'no-cors' mode, aber wir nutzen hier Standard-POST)
            await fetch(N8N_WEBHOOK_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            });
            console.log("Sende an n8n:", formData);

            await new Promise(r => setTimeout(r, 1000));

            // Erfolgreich gesendet, zeige Kalender
            showCalendly(name, email);

        } catch (error) {
            console.error("Fehler beim Senden:", error);
            // Fallback: Trotzdem Kalender anzeigen, damit der Lead nicht verloren geht
            showCalendly(name, email);
        }
    }

    function showCalendly(name, email) {
        // Container verbreitern f√ºr Kalender
        document.getElementById('funnelContainer').classList.add('wide-mode');
        
        // Zum n√§chsten Step (Step 5) wechseln
        nextStep(5);

        // Calendly initialisieren
        Calendly.initInlineWidget({
            url: CALENDLY_LINK,
            parentElement: document.getElementById('calendly-embed'),
            prefill: {
                name: name,
                email: email
            },
            utm: {}
        });
    }
    
    updateProgress();
</script>

</body>
</html>
